<!-- Modal -->
<div class="modal fade modal-xl" id="ModalCadastrarCurso" tabindex="-1" aria-labelledby="exampleModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal_maior">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Curso</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <form method="post" action="{{url('admin/cursos/cadastrar')}}" id="cadastrarCurso"
              enctype="multipart/form-data">

              <h5 class="modal-title fw-bold" id="exampleModalLabel">Cadastrar Curso</h5>
              <div class="row">
                <div class="col-lg-11-3qtr card border-2 shadow-sm mt-2 mb-3 me-4 ms-4">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="entidade_id" class="form-label">Entidade Responsável</label>
                          <select id="entidade_id" name="entidade_id" class="form-control" required>
                            <option value=""><span class="flag-icon flag-icon-gr"></span>Selecione
                            </option>
                            {% for entidade in entidades %}
                            <option value="{{entidade.id}}" {% if entidade.id==cursos.entidade_id %} selected {%endif%}>
                              {{entidade.nome }}
                            </option>
                            {% endfor %}
                          </select>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="especializacao_id" class="form-label">Especialização</label>
                          <select id="especializacao_id" name="especializacao_id" class="form-control" required>
                            <option value=""><span class="flag-icon flag-icon-gr"></span>Selecione
                            </option>
                            {% for especializacao in especializacoes %}
                            <option value="{{especializacao.id}}" {% if especializacao.id==cursos.especializacao_id %}
                              selected {%endif%}>
                              {{especializacao.especializacao }}
                            </option>
                            {% endfor %}
                          </select>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-6">
                        <div class="mb-3">
                          <label for="nome" class="form-label">Nome</label>
                          <input type="text" name="nome" class="form-control">
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="mb-3">
                          <label for="data_inicio_curso" class="form-label">Data Inicio do Curso</label>
                          <input type="date" name="data_inicio_curso" id="data_inicio_curso" class="form-control">
                        </div>
                      </div>
                      <div class="col-md-3">
                        <div class="mb-3">
                          <label for="data_fim_curso" class="form-label">Data Final do Curso</label>
                          <input type="date" name="data_fim_curso" id="data_fim_curso" class="form-control">
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="hora_inicio" class="form-label">Horário de Inicio</label>
                          <input type="time" name="hora_inicio" id="hora_inicio" class="form-control">
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="hora_fim" class="form-label">Horário de Termino</label>
                          <input type="time" name="hora_fim" id="hora_fim" class="form-control">
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="vagas" class="form-label">Vagas</label>
                          <input type="number" name="vagas" id="vagas" class="form-control">
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="inicio_inscricao" class="form-label">Data Inicio de Inscrição</label>
                          <input type="date" name="inicio_inscricao" class="form-control">
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="fim_inscricao" class="form-label">Data Final de Inscrição</label>
                          <input type="date" name="fim_inscricao" class="form-control">
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-12">
                        <div class="mb-3">
                          <label for="descricao" class="form-label">Descrição</label>
                          <textarea id="descricao" name="descricao" class="form-control" rows="3"></textarea>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-4">
                        <div class="mb-3">
                          <label for="professor_id" class="form-label">Professor</label>
                          <select id="professor_id" name="professor_id" class="form-control" required>
                            <option value=""><span class="flag-icon flag-icon-gr"></span>Selecione
                            </option>
                            {% for professor in professores %}
                            <option value="{{professor.id}}" {% if professor.id==atividades.professor_id %} selected
                              {%endif%}>
                              {{professor.nome }}
                            </option>
                            {% endfor %}
                          </select>
                        </div>
                      </div>
                      <div class="col-md-4 d-none espaco_hidden">
                        <div class="mb-3">
                          <label for="espaco_id" class="form-label">Sala</label>
                          <select id="espaco_id" name="espaco_id" class="form-control" required>
                            <option value=""><span class="flag-icon flag-icon-gr"></span>Selecione
                            </option>
                            {% for espaco in espacos %}
                            <option value="{{espaco.id}}" {% if espaco.id==atividades.espaco_id %} selected {%endif%}>
                              {{espaco.numero_sala }}
                            </option>
                            {% endfor %}
                          </select>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="mb-3">
                    <button type="submit" class="btn btn-dark me-2" value="">Cadastrar</button><button type="button"
                      class="btn btn-warning" onClick="window.location.reload();">
                      Cancelar </button>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
  $(document).ready(function () {

    $('#ModalCadastrarCurso, #ModalEditarCurso').find('#data_inicio_curso, #data_fim_curso, #hora_inicio, #hora_fim, #vagas').on("blur", function () {
      var array = [$('#data_inicio_curso').val().trim(), $('#data_fim_curso').val().trim(), $('#hora_inicio').val().trim(), $('#hora_fim').val().trim(), $('#vagas').val().trim()]

      if (!array.includes('')) {
        $('.espaco_hidden').children().remove()
        $('.espaco_hidden').removeClass('d-none')
        $.ajax({
          type: "POST",
          dataType: "json",
          url: 'buscarEspaco',
          data: {
            data_inicio_curso: array[0],
            data_fim_curso: array[1],
            hora_inicio: array[2],
            hora_fim: array[3],
            vagas: array[4]
          },
          success: function (data) {
            var html_up = `<div class="mb-3">
              <label for="espaco_id" class="form-label">Sala</label>
              <select id="espaco_id" name="espaco_id" class="form-control" required>
                <option value=""><span class="flag-icon flag-icon-gr"></span>Selecione
                </option>`;
            var html_down = `</select>
          </div>`;
            var html = ''
            $.each(data, function (key, value) {
              html += `
              <option value="${value.id}">Número: ${value.numero_sala} - Andar: ${value.andar}</option>`
            })

            var html_total = html_up + html + html_down
            $('.espaco_hidden').append(html_total)
          }
        })
      } else {
        $('.espaco_hidden').children().remove()
        $('.espaco_hidden').addClass('d-none')
      }
    })
  })
</script>